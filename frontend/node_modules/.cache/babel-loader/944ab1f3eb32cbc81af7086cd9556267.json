{"ast":null,"code":"import _regeneratorRuntime from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from\"react\";import{useCallback,useEffect,useState}from\"react\";import{Link as ReactRouterLink,useParams}from\"react-router-dom\";import{Avatar,Box,Button,Center,chakra,Flex,HStack,Image,Link,Spinner,VStack,useColorModeValue,Modal,ModalOverlay,ModalContent,ModalHeader,ModalCloseButton,ModalBody,FormControl,FormLabel,ModalFooter,Select,NumberInput,NumberInputField,SimpleGrid,GridItem,useDisclosure,useToast,useBoolean,Grid}from\"@chakra-ui/react\";import{CW721,publicIpfsUrl,formatAddress,formatPrice,Market,toMinDenom,useSdk}from\"../../services\";import{TransactionLink}from\"../../components\";import{coins,config}from\"../../../config\";import userLogo from\"../../assets/user-default.svg\";import cosmverseLogo from\"../../assets/cosmverse.jpg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var AccountToken=function AccountToken(){var _useParams=useParams(),id=_useParams.id;var _useSdk=useSdk(),client=_useSdk.client,address=_useSdk.address,getSignClient=_useSdk.getSignClient;var _useState=useState(),_useState2=_slicedToArray(_useState,2),nft=_useState2[0],setNft=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),owner=_useState4[0],setOwner=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),offer=_useState6[0],setOffer=_useState6[1];var _useBoolean=useBoolean(),_useBoolean2=_slicedToArray(_useBoolean,2),loading=_useBoolean2[0],setLoading=_useBoolean2[1];var toast=useToast();var _useDisclosure=useDisclosure(),isOpen=_useDisclosure.isOpen,onOpen=_useDisclosure.onOpen,onClose=_useDisclosure.onClose;var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),amount=_useState8[0],setAmount=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),denom=_useState10[0],setDenom=_useState10[1];var loadData=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var contract,marketContract,result,offer;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(client){_context.next=2;break;}return _context.abrupt(\"return\");case 2:contract=CW721(config.contract).use(client);marketContract=Market(config.marketContract).use(client);_context.next=6;return contract.nftInfo(id);case 6:result=_context.sent;result.image=publicIpfsUrl(result.image);_context.next=10;return marketContract.offer(config.contract,id);case 10:offer=_context.sent;setOffer(offer);_context.t0=setOwner;if(!offer){_context.next=17;break;}_context.t1=offer.seller;_context.next=20;break;case 17:_context.next=19;return contract.ownerOf(id);case 19:_context.t1=_context.sent;case 20:_context.t2=_context.t1;(0,_context.t0)(_context.t2);setNft(result);case 23:case\"end\":return _context.stop();}}},_callee);})),[client,id]);useEffect(function(){loadData();},[loadData]);var handleSell=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var signClient,contract,price,txHash;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:signClient=getSignClient();if(signClient){_context2.next=4;break;}toast({title:\"Account required.\",description:\"Please, connect wallet.\",status:\"warning\",position:\"top\",isClosable:true});return _context2.abrupt(\"return\");case 4:if(!(!amount||!denom)){_context2.next=6;break;}return _context2.abrupt(\"return\");case 6:onClose();setLoading.on();_context2.prev=8;contract=CW721(config.contract).useTx(signClient);price={list_price:{amount:toMinDenom(amount,denom),denom:denom}};_context2.next=13;return contract.send(address,config.marketContract,price,id);case 13:txHash=_context2.sent;toast({title:\"Successful Transaction\",description:/*#__PURE__*/_jsx(TransactionLink,{tx:txHash}),status:\"success\",position:\"bottom-right\",isClosable:true});_context2.next=17;return loadData();case 17:_context2.next=22;break;case 19:_context2.prev=19;_context2.t0=_context2[\"catch\"](8);toast({title:\"Error\",description:\"\".concat(_context2.t0),status:\"error\",position:\"bottom-right\",isClosable:true});case 22:_context2.prev=22;setLoading.off();return _context2.finish(22);case 25:case\"end\":return _context2.stop();}}},_callee2,null,[[8,19,22,25]]);}));return function handleSell(){return _ref2.apply(this,arguments);};}();var handleWithdraw=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var signClient,contract,txHash;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:signClient=getSignClient();if(signClient){_context3.next=4;break;}toast({title:\"Account required.\",description:\"Please, connect wallet.\",status:\"warning\",position:\"top\",isClosable:true});return _context3.abrupt(\"return\");case 4:if(offer){_context3.next=6;break;}return _context3.abrupt(\"return\");case 6:setLoading.on();_context3.prev=7;contract=Market(config.marketContract).useTx(signClient);_context3.next=11;return contract.withdraw(address,offer.id);case 11:txHash=_context3.sent;toast({title:\"Successful Transaction\",description:/*#__PURE__*/_jsx(TransactionLink,{tx:txHash}),status:\"success\",position:\"bottom-right\",isClosable:true});_context3.next=15;return loadData();case 15:_context3.next=20;break;case 17:_context3.prev=17;_context3.t0=_context3[\"catch\"](7);toast({title:\"Error\",description:\"\".concat(_context3.t0),status:\"error\",position:\"bottom-right\",isClosable:true});case 20:_context3.prev=20;setLoading.off();return _context3.finish(20);case 23:case\"end\":return _context3.stop();}}},_callee3,null,[[7,17,20,23]]);}));return function handleWithdraw(){return _ref3.apply(this,arguments);};}();var loadingSkeleton=/*#__PURE__*/_jsx(Center,{children:/*#__PURE__*/_jsx(Spinner,{size:\"xl\"})});var borderColor=useColorModeValue('cyan.900','white.200');var priceModal=/*#__PURE__*/_jsxs(Modal,{closeOnOverlayClick:false,isOpen:isOpen,onClose:onClose,children:[/*#__PURE__*/_jsx(ModalOverlay,{}),/*#__PURE__*/_jsxs(ModalContent,{children:[/*#__PURE__*/_jsx(ModalHeader,{children:\"Create sell order\"}),/*#__PURE__*/_jsx(ModalCloseButton,{}),/*#__PURE__*/_jsxs(ModalBody,{pb:6,children:[/*#__PURE__*/_jsx(FormLabel,{fontFamily:\"mono\",fontWeight:\"semibold\",children:\"Price\"}),/*#__PURE__*/_jsxs(SimpleGrid,{columns:6,spacing:3,children:[/*#__PURE__*/_jsx(FormControl,{as:GridItem,colSpan:[6,4],children:/*#__PURE__*/_jsx(NumberInput,{onChange:function onChange(_,value){return setAmount(value);},children:/*#__PURE__*/_jsx(NumberInputField,{})})}),/*#__PURE__*/_jsx(FormControl,{as:GridItem,colSpan:[6,2],children:/*#__PURE__*/_jsx(Select,{placeholder:\"Select coin\",onChange:function onChange(e){return setDenom(e.target.value);},children:coins.map(function(c){return/*#__PURE__*/_jsx(\"option\",{value:c.denom,children:c.name});})})})]})]}),/*#__PURE__*/_jsx(ModalFooter,{children:/*#__PURE__*/_jsx(Button,{onClick:handleSell,colorScheme:\"pink\",mr:3,children:\"Confirm\"})})]})]});return/*#__PURE__*/_jsxs(Box,{m:5,children:[!nft?loadingSkeleton:/*#__PURE__*/_jsxs(Grid,{minH:\"80vh\",gridTemplateColumns:{sm:\"repeat(1, minmax(0px, 1fr))\",md:\"repeat(8, minmax(0px, 1fr))\"},children:[/*#__PURE__*/_jsx(GridItem,{colSpan:5,children:/*#__PURE__*/_jsx(Flex,{h:\"full\",justifyContent:\"center\",alignItems:\"center\",children:/*#__PURE__*/_jsx(Image,{bgGradient:\"linear(to-r, cyan.200, white.200)\",roundedTop:\"md\",boxSize:\"420px\",fit:\"cover\",fallbackSrc:cosmverseLogo,src:nft.image,alt:nft.name})})}),/*#__PURE__*/_jsx(GridItem,{colSpan:3,children:/*#__PURE__*/_jsx(Flex,{h:\"80vh\",children:/*#__PURE__*/_jsxs(VStack,{spacing:6,align:\"stretch\",children:[/*#__PURE__*/_jsxs(Box,{py:2,children:[/*#__PURE__*/_jsx(chakra.h1,{fontWeight:\"bold\",fontSize:\"3xl\",children:nft.name}),/*#__PURE__*/_jsx(chakra.p,{mt:1,fontSize:\"xs\",color:\"cyan.500\",children:\"@unknown\"}),/*#__PURE__*/_jsx(chakra.p,{mt:1,maxW:\"400px\",fontSize:\"md\",children:nft.description})]}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(VStack,{spacing:2,align:\"stretch\",children:[/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(chakra.p,{fontFamily:\"mono\",fontSize:\"md\",color:\"gray.500\",children:\"Owner\"})}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(HStack,{children:[/*#__PURE__*/_jsx(Avatar,{size:\"sm\",name:\"Juno\",src:userLogo}),/*#__PURE__*/_jsx(Link,{fontSize:\"md\",fontWeight:\"semibold\",_hover:{color:\"gray.600\"},as:ReactRouterLink,to:\"/account/\".concat(owner),children:formatAddress(owner)})]})})]})}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(VStack,{spacing:2,align:\"stretch\",children:[/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(chakra.p,{fontFamily:\"mono\",fontSize:\"md\",color:\"gray.500\",children:\"Price\"})}),/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(chakra.p,{fontWeight:\"semibold\",fontSize:\"md\",children:offer?formatPrice(offer.list_price):\"Not listed\"})})]})}),/*#__PURE__*/_jsx(Box,{py:6,borderTop:1,borderStyle:'solid',borderColor:borderColor,children:offer?/*#__PURE__*/_jsx(Button,{isLoading:loading,onClick:handleWithdraw,title:\"Withdraw NFT\",type:\"button\",height:\"var(--chakra-sizes-10)\",fontSize:'md',fontWeight:\"semibold\",borderRadius:'50px',color:'white',bg:\"pink.500\",_hover:{bg:\"pink.700\"},children:\"Cancel\"}):/*#__PURE__*/_jsx(Button,{isLoading:loading,onClick:onOpen,type:\"button\",height:\"var(--chakra-sizes-10)\",fontSize:'md',fontWeight:\"semibold\",borderRadius:'50px',color:'white',bg:\"pink.500\",_hover:{bg:\"pink.700\"},children:\"Sell\"})})]})})})]}),priceModal]});};","map":null,"metadata":{},"sourceType":"module"}