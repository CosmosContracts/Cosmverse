{"ast":null,"code":"import _regeneratorRuntime from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from\"react\";import{useState}from\"react\";import{useHistory}from\"react-router-dom\";import{Box,Button,Flex,FormControl,FormLabel,Heading,Input,Textarea,useBoolean,useToast}from\"@chakra-ui/react\";import{Bech32,toHex}from\"@cosmjs/encoding\";import{FileUpload,TransactionLink}from\"../../components\";import{CW721,unSanitizeIpfsUrl,uploadFile,useSdk}from\"../../services\";import{config}from\"../../../config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function generateId(address){// TODO: Format ID?\nvar pubkey=toHex(Bech32.decode(address).data);return((pubkey===null||pubkey===void 0?void 0:pubkey.substr(2,10))+(pubkey===null||pubkey===void 0?void 0:pubkey.substring(pubkey.length-8))+'-'+Math.random().toString(36).substr(2,9)).toUpperCase();}export var Create=function Create(){var toast=useToast();var history=useHistory();var _useSdk=useSdk(),getSignClient=_useSdk.getSignClient,address=_useSdk.address;var _useState=useState(),_useState2=_slicedToArray(_useState,2),files=_useState2[0],setFiles=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),nftName=_useState4[0],setNftName=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),description=_useState6[0],setDescription=_useState6[1];var _useBoolean=useBoolean(),_useBoolean2=_slicedToArray(_useBoolean,2),loading=_useBoolean2[0],setLoading=_useBoolean2[1];function createNft(_x){return _createNft.apply(this,arguments);}function _createNft(){_createNft=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var nftId,fileHash,nftMsg,contract,txHash;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// TODO: use formik validations\ne.preventDefault();if(address){_context.next=4;break;}toast({title:\"Account required.\",description:\"Please connect wallet.\",status:\"warning\",position:\"top\",isClosable:true});return _context.abrupt(\"return\");case 4:if(!(!files||files.length===0)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:setLoading.on();// TODO: Load on init page and show after load page\nnftId=generateId(address);_context.prev=8;_context.next=11;return uploadFile(files[0]);case 11:fileHash=_context.sent;console.log(fileHash,nftId);nftMsg={token_id:nftId,owner:address,name:nftName,description:description,image:unSanitizeIpfsUrl(fileHash)};contract=CW721(config.contract).useTx(getSignClient());_context.next=17;return contract.mint(address,nftMsg);case 17:txHash=_context.sent;toast({title:\"Successful Transaction\",description:/*#__PURE__*/_jsx(TransactionLink,{tx:txHash}),status:\"success\",position:\"bottom-right\",isClosable:true});setLoading.off();history.push(\"/account/token/\".concat(nftId));_context.next=27;break;case 23:_context.prev=23;_context.t0=_context[\"catch\"](8);toast({title:\"Error\",description:\"\".concat(_context.t0),status:\"error\",position:\"bottom-right\",isClosable:true});setLoading.off();case 27:case\"end\":return _context.stop();}}},_callee,null,[[8,23]]);}));return _createNft.apply(this,arguments);}return/*#__PURE__*/_jsx(Flex,{p:4,mb:8,justifyContent:\"center\",direction:\"row\",children:/*#__PURE__*/_jsx(Box,{maxW:\"500px\",w:\"100%\",children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Box,{mt:6,mb:10,children:/*#__PURE__*/_jsx(Heading,{as:\"h3\",fontSize:\"3xl\",children:\"Create a single NFT\"})}),/*#__PURE__*/_jsxs(Box,{as:'form',id:\"nft-form\",onSubmit:createNft,children:[/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsxs(FormControl,{id:\"name\",isRequired:true,children:[/*#__PURE__*/_jsx(FormLabel,{fontSize:\"sm\",fontFamily:\"mono\",fontWeight:\"semibold\",children:\"Image\"}),/*#__PURE__*/_jsx(FileUpload,{accept:\"image/*\",onDrop:function onDrop(acceptedFiles){return setFiles(acceptedFiles);}})]})}),/*#__PURE__*/_jsx(Box,{mt:4,children:/*#__PURE__*/_jsxs(FormControl,{id:\"name\",isRequired:true,children:[/*#__PURE__*/_jsx(FormLabel,{fontSize:\"sm\",fontFamily:\"mono\",fontWeight:\"semibold\",children:\"Name\"}),/*#__PURE__*/_jsx(Input,{name:\"name\",spellCheck:false,onChange:function onChange(e){return setNftName(e.target.value);}})]})}),/*#__PURE__*/_jsx(Box,{mt:4,children:/*#__PURE__*/_jsxs(FormControl,{id:\"description\",children:[/*#__PURE__*/_jsx(FormLabel,{fontSize:\"sm\",fontFamily:\"mono\",fontWeight:\"semibold\",children:\"Description\"}),/*#__PURE__*/_jsx(Textarea,{name:\"description\",placeholder:\"NFT description\",spellCheck:false,onChange:function onChange(e){return setDescription(e.target.value);}})]})}),/*#__PURE__*/_jsx(Box,{mt:6,children:/*#__PURE__*/_jsx(Button,{isLoading:loading,loadingText:\"Minting\",type:\"submit\",height:\"var(--chakra-sizes-10)\",fontSize:'md',fontWeight:\"semibold\",borderRadius:'50px',color:'white',bg:\"pink.500\",_hover:{bg:\"gray.500\"},children:\"Create\"})})]})]})})});};","map":null,"metadata":{},"sourceType":"module"}