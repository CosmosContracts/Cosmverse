{"ast":null,"code":"import _regeneratorRuntime from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/pauloponciano/Documents/cosmverse/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import*as React from\"react\";import{useCallback,useEffect,useState}from\"react\";import{Box}from\"@chakra-ui/react\";import{LoadingSpinner,NftTable,Pagination}from\"../../components\";import{CW721,formatPrice,Market,publicIpfsUrl,useSdk}from\"../../services\";import{config}from\"../../../config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var pageSize=15;export var Gallery=function Gallery(){var _useSdk=useSdk(),client=_useSdk.client;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),nfts=_useState2[0],setNfts=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),totalTokens=_useState4[0],setTotalTokens=_useState4[1];var _useState5=useState([undefined]),_useState6=_slicedToArray(_useState5,2),pages=_useState6[0],setPages=_useState6[1];var loadNfts=useCallback(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(page){var start,contract,marketcw,result,numTokens,allNfts,allOffers,tokens,offers,items,lastTokenId;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(client){_context.next=2;break;}return _context.abrupt(\"return\");case 2:start=pages[page-1];contract=CW721(config.contract).use(client);marketcw=Market(config.marketContract).use(client);_context.next=7;return contract.allTokens(start,pageSize);case 7:result=_context.sent;_context.next=10;return contract.numTokens();case 10:numTokens=_context.sent;allNfts=[];allOffers=[];result.tokens.forEach(function(tokenId){allNfts.push(contract.nftInfo(tokenId));allOffers.push(marketcw.offer(config.contract,tokenId));});_context.next=16;return Promise.all(allNfts);case 16:tokens=_context.sent;_context.next=19;return Promise.all(allOffers);case 19:offers=_context.sent;items=tokens.map(function(nft,idx){var off=offers[idx];return{tokenId:result.tokens[idx],user:'unknown',title:nft.name,price:off?formatPrice(off.list_price):\"Not listed\",image:publicIpfsUrl(nft.image),total:1};});if(page>=pages.length){lastTokenId=result.tokens[result.tokens.length-1];pages.push(lastTokenId);setPages(pages);}setPages(pages);setNfts(items);setTotalTokens(numTokens);case 25:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}(),[client,pages]);useEffect(function(){loadNfts(1);},[loadNfts]);var handlePage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(page){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return loadNfts(page);case 2:case\"end\":return _context2.stop();}}},_callee2);}));return function handlePage(_x2){return _ref2.apply(this,arguments);};}();var bodyContent=/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(NftTable,{data:nfts}),/*#__PURE__*/_jsx(Pagination,{onChangePage:handlePage,total:totalTokens,step:pageSize})]});return/*#__PURE__*/_jsx(Box,{mx:5,my:8,children:nfts.length===0?/*#__PURE__*/_jsx(LoadingSpinner,{}):bodyContent});};","map":null,"metadata":{},"sourceType":"module"}